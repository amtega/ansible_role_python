---

# Dependencies

python_os_dependencies:
  - bzip2-devel
  - curl
  - libffi-devel
  - make
  - findutils
  - gcc
  - openssl-devel
  - tcl-devel
  - yum-utils
  - perl
  - python-setuptools

# Download info

python_download_site: https://www.python.org/ftp/python

python_download_base_url: >-
  {{ python_download_site
     + "/"
     + python_effective_version
     + "/" }}

python_download_file: "Python-{{ python_effective_version }}.tgz"

python_download_site_content: >-
  {{ lookup("url", python_download_site, wantlist=True) }}

python_download_site_versions: >-
  {{ python_download_site_content
     | select("search", ">[0-9]+\.[0-9]\.?[0-9]*")
     | map("regex_replace", ".*>([0-9]+\.[0-9]\.?[0-9]*).*", "\1")
     | list }}

python_download_site_last_version: "{{ python_download_site_versions | last }}"

openssl_download_site: https://www.openssl.org/source

openssl_download_site_content: >-
  {{ lookup("url", openssl_download_site, wantlist=True) }}

openssl_download_file: >-
  {{ openssl_download_site_content
     | select("search", ".*openssl-1.*tar.gz.*")
     | map("regex_replace", ".*href=.(openssl-1.*.tar.gz).*", "\1")
     | list
     | first }}

openssl_download_file_without_ext: >-
  {{ openssl_download_file | regex_replace("\.tar\.gz", "") }}

openssl_download_url: "{{ openssl_download_site }}/{{ openssl_download_file }}"

# Version variables

python_minimum_version: 3.5.0

python_effective_version: >-
  {{ (python_version == "latest")
     | ternary(python_download_site_last_version, python_version) }}

openssl_effective_version: >-
  {{ (python_openssl_version == "latest")
     | ternary(openssl_download_file_without_ext
               | regex_replace(".*-(.*)", "\1"), python_openssl_version) }}

# Directories

python_source_compile_dir: >-
  {{ python_tmp_dir }}/Python-{{ python_effective_version }}

python_default_install_dir: "/opt/python-{{ python_effective_version }}"

openssl_source_compile_dir: >-
  {{ python_tmp_dir
     + "/"
     + openssl_download_file_without_ext }}

openssl_default_install_dir: "/opt/openssl-{{ openssl_effective_version }}"

# Executables

python_executable_file_path: >-
  {{ python_compiled_install_dir | default(python_default_install_dir)
     + "/bin/python"
     + python_effective_version.split(".")[0] }}

python_pip_executable_path: >-
  {{ python_compiled_install_dir | default(python_default_install_dir)
     + "/bin/pip"
     + python_effective_version.split(".")[0] }}

python_virtualenv_executable_path: >-
  {{ python_compiled_install_dir | default(python_default_install_dir)
     + "/bin/virtualenv"
     + python_effective_version.split(".")[0] }}

# Compilation vars

python_openssl_compile_env: >-
  export PATH={{ openssl_default_install_dir }}/bin:$PATH ;
  export LD_LIBRARY_PATH={{ openssl_default_install_dir }}/lib ;
  export LD_FLAGS='-L{{ openssl_default_install_dir }}/lib
  -Wl,-rpath,{{ openssl_default_install_dir }}/lib' ;
  export LANGUAGE=en_US

python_compile_env: >-
  {{ (python_distribution_version is ("7", "<"))
     | ternary(python_openssl_compile_env, "/bin/true") }}

python_openssl_compile_options: >-
  {{ "--with-openssl="
     + openssl_compiled_install_dir
       | default(openssl_default_install_dir) }}

python_extra_compile_options: >-
  {{ (python_distribution_version is ("7", "<"))
     | ternary([python_openssl_compile_options], []) }}

python_ld_conf_path: >-
  /etc/ld.so.conf.d/{{ python_openssl_ld_conf_file_name }}

# Misc vars

python_install_required: >-
  {{ }}
